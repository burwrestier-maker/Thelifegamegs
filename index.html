<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BPS Chronicles - Definitive Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root { 
            --gold: #f1c40f; --bg: #0d0e18; --panel: #1c1f33; --border: #4a517a;
            --common: #bdc3c7; --rare: #3498db; --epic: #9b59b6; --legendary: #f1c40f;
            --xp: #9b59b6;
        }

        * { box-sizing: border-box; font-family: 'Press Start 2P', cursive; touch-action: manipulation; user-select: none; }
        body { margin: 0; background: #000; color: #e0e0e0; overflow: hidden; width: 100vw; height: 100vh; }

        /* CONTROLES FIXOS (TELA CHEIA E M√öSICA) */
        .system-controls {
            position: fixed; top: 10px; right: 10px; z-index: 1000;
            display: flex; gap: 10px;
        }
        .sys-btn { 
            background: rgba(0,0,0,0.6); border: 1px solid var(--gold); 
            color: var(--gold); padding: 8px; font-size: 8px; cursor: pointer;
        }

        /* ANIMA√á√ïES */
        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-5px);} 75% {transform: translateX(5px);} }
        .animate-shake { animation: shake 0.2s; }

        @keyframes player-attack-motion {
            0% { transform: translateX(0) scale(1); }
            30% { transform: translateX(130px) scale(1.2) rotate(15deg); }
            50% { transform: translateX(130px) scale(1.2) rotate(15deg); }
            100% { transform: translateX(0) scale(1); }
        }
        .animate-player-atk { animation: player-attack-motion 0.6s ease-in-out; position: relative; z-index: 10; }

        /* TELAS */
        .screen { display: none; width: 100vw; height: 100vh; padding: 20px; flex-direction: column; align-items: center; justify-content: center; background-size: cover; background-position: center; }
        .active { display: flex; }

        /* UI */
        .ui-panel { background: var(--panel); border: 4px solid var(--border); padding: 20px; width: 95%; max-width: 800px; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .stats-banner { background: #000; border: 2px solid var(--gold); padding: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; font-size: 9px; }
        
        input[type="text"] { background: #000; border: 3px solid var(--border); color: var(--gold); padding: 12px; font-size: 10px; width: 100%; text-align: center; margin-bottom: 10px; outline: none; }
        button { background: #111; color: var(--gold); border: 2px solid var(--gold); padding: 12px; cursor: pointer; font-size: 8px; transition: 0.2s; }
        button:hover:not(:disabled) { background: var(--gold); color: #000; }
        button:disabled { opacity: 0.3; filter: grayscale(1); }
        .disabled-state { pointer-events: none; opacity: 0.6; }

        .item-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-height: 250px; overflow-y: auto; padding: 5px; }
        .bar-container { width: 100%; height: 12px; background: #333; border: 2px solid #fff; margin: 4px 0; overflow: hidden; }
        .bar-fill { height: 100%; transition: width 0.4s; }
        
        .battle-log { background: #000; border: 2px solid var(--gold); height: 100px; width: 100%; overflow-y: auto; padding: 8px; font-size: 8px; color: #0f0; margin-top: 10px; line-height: 1.5; }
    </style>
</head>
<body>
    <audio id="bgm" src="https://www.chosic.com/wp-content/uploads/2021/07/The-Old-Tower-Inn.mp3" loop></audio>

    <div class="system-controls">
        <button class="sys-btn" onclick="toggleMusic()">üéµ M√öSICA: <span id="mus-status">OFF</span></button>
        <button class="sys-btn" onclick="toggleFS()">üì∫ TELA CHEIA</button>
    </div>

    <div id="scr-start" class="screen active" style="background: radial-gradient(#1c1f33, #000);">
        <div class="ui-panel" style="max-width: 500px; text-align: center;">
            <h1 style="color:var(--gold); font-size: 18px; margin-bottom: 20px;">BPS CHRONICLES</h1>
            <input type="text" id="p-name-input" placeholder="SEU NOME..." maxlength="12">
            <p style="font-size: 8px; margin-bottom: 10px;">ESCOLHA SUA ORIGEM:</p>
            <div style="display:flex; flex-direction: column; gap:10px;">
                <button onclick="initGame('Mago', '97072.jpg')">üßô MAGO</button>
                <button onclick="initGame('Maldi√ß√£o', '97073.jpg')">üíÄ MALDI√á√ÉO</button>
                <button onclick="initGame('Humano', '97074.jpg')">‚öîÔ∏è HUMANO</button>
            </div>
        </div>
    </div>

    <div id="scr-hub" class="screen" style="background-image: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), url('97057.jpg');">
        <div class="ui-panel">
            <div style="display: flex; justify-content: space-between; align-items: baseline; border-bottom: 2px solid var(--gold); padding-bottom: 5px; margin-bottom: 10px;">
                <h2 id="hub-name" style="color:var(--gold); margin: 0; font-size: 14px;">NOME</h2>
                <span id="hub-race" style="font-size: 8px; color: #aaa;">CLASSE</span>
            </div>

            <div class="stats-banner">
                <div>‚ù§Ô∏è HP: <span id="st-hp">100</span></div>
                <div>‚öîÔ∏è FOR: <span id="st-str">10</span></div>
                <div>üí∞ BPS: <span id="hub-coins">0</span></div>
                <div>‚≠ê LV: <span id="st-lv">1</span></div>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button onclick="changeScreen('scr-battle')" style="grid-column: span 2; padding: 18px; background: #3d1414;">‚öîÔ∏è ENFRENTAR BOSS</button>
                <button onclick="changeScreen('scr-habits')" style="border-color:#2ecc71;">üèãÔ∏è MISS√ïES</button>
                <button onclick="changeScreen('scr-inv')">üéí MOCHILA</button>
                <button onclick="exportSave()" style="font-size:6px;">üíæ EXPORTAR</button>
                <button onclick="resetGame()" style="color:#e74c3c; font-size:6px;">‚ùå RESET</button>
            </div>
        </div>
    </div>

    <div id="scr-habits" class="screen" style="background:#000;">
        <div class="ui-panel">
            <button onclick="changeScreen('scr-hub')">< VOLTAR</button>
            <h3 style="text-align:center;">MISS√ïES DI√ÅRIAS</h3>
            <div style="display:flex; gap:5px; margin-bottom:15px;">
                <input type="text" id="new-task-name" placeholder="Nova tarefa..." style="margin-bottom:0; font-size:7px; flex:2;">
                <button onclick="addNewTask()" style="flex:1;">ADD</button>
            </div>
            <div id="tasks-list" style="display:flex; flex-direction:column; gap:8px;"></div>
            <div id="daily-feedback" style="margin-top:15px; font-size:8px; color:var(--gold); text-align:center; display:none;">üéâ DIA CONCLU√çDO!</div>
        </div>
    </div>

    <div id="scr-battle" class="screen" style="background:#050505;">
        <div style="display:flex; justify-content:space-around; width:100%; align-items:flex-end; margin-bottom:20px;">
            <div id="fig-p" style="text-align:center; width: 140px;">
                <img id="bt-img-p" src="" style="width:100px; height: 100px; object-fit: cover; border:2px solid #fff;">
                <div class="bar-container"><div id="bt-hp-p" class="bar-fill" style="background:#2ecc71; width:100%;"></div></div>
            </div>
            <div id="fig-b" style="text-align:center; width: 160px;">
                <img id="bt-img-b" src="" style="width:130px; height: 130px; object-fit: cover; border:2px solid #f00;">
                <div class="bar-container"><div id="bt-hp-b" class="bar-fill" style="background:#e74c3c; width:100%;"></div></div>
            </div>
        </div>
        <div id="battle-log" class="battle-log"></div>
        <div id="battle-btns" style="display:flex; gap:10px; margin-top:20px;"></div>
    </div>

    <script>
        const BOSSES = [{ n: "Elemental", img: "97056.jpg", hp: 150, atk: 20, rew: 100 }];
        let p = JSON.parse(localStorage.getItem("bps_v3_save")) || {
            name: "", race: "", img: "", coins: 100, pts: 0, lv: 1, xp: 0, xpNext: 100,
            str: 10, hpM: 100, customTasks: [], dailyDone: 0
        };
        let bt = { active: false, pHP: 0, bHP: 0 };
        let musicOn = false;

        // CONTROLES DE SISTEMA
        function toggleMusic() {
            const audio = document.getElementById("bgm");
            musicOn = !musicOn;
            if(musicOn) audio.play(); else audio.pause();
            document.getElementById("mus-status").textContent = musicOn ? "ON" : "OFF";
        }

        function toggleFS() {
            if (!document.fullscreenElement) document.documentElement.requestFullscreen();
            else if (document.exitFullscreen) document.exitFullscreen();
        }

        // INICIAR JOGO
        function initGame(race, img) {
            const name = document.getElementById("p-name-input").value.trim();
            if(!name) return alert("D√™ um nome!");
            p.name = name; p.race = race; p.img = img;
            changeScreen('scr-hub');
            if(!musicOn) toggleMusic(); // Tenta ligar a m√∫sica no primeiro clique
        }

        function changeScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'scr-habits') renderTasks();
            if(id === 'scr-battle') startBattle();
            updateUI();
        }

        // TAREFAS
        function addNewTask() {
            const input = document.getElementById("new-task-name");
            if(!input.value) return;
            p.customTasks.push({ n: input.value, pts: 5 });
            input.value = ""; renderTasks();
        }

        function renderTasks() {
            const list = document.getElementById("tasks-list"); list.innerHTML = "";
            [{n:'√Ågua', pts:3}, ...p.customTasks].forEach(t => {
                const btn = document.createElement("button");
                btn.innerHTML = `${t.n} (+${t.pts} PTS)`;
                btn.onclick = () => {
                    p.dailyDone++; p.pts += t.pts;
                    if(p.dailyDone === 3) document.getElementById("daily-feedback").style.display = "block";
                    alert(`Feito! +${t.pts} pontos.`); updateUI();
                };
                list.appendChild(btn);
            });
        }

        // BATALHA COM ANIMA√á√ÉO
        function startBattle() {
            const boss = BOSSES[0];
            bt = { active: true, pHP: p.hpM, pMaxHP: p.hpM, bHP: boss.hp, bMaxHP: boss.hp };
            document.getElementById("bt-img-p").src = p.img;
            document.getElementById("bt-img-b").src = boss.img;
            document.getElementById("battle-btns").innerHTML = `<button onclick="atkPlayer()">‚öîÔ∏è ATAQUE</button>`;
            refreshBars();
        }

        function atkPlayer() {
            if(!bt.active) return;
            const img = document.getElementById("bt-img-p");
            const btns = document.getElementById("battle-btns");
            btns.classList.add('disabled-state');
            img.classList.add('animate-player-atk');

            setTimeout(() => {
                let dmg = p.str + Math.floor(Math.random()*5);
                bt.bHP -= dmg;
                log(`Voc√™ atacou: ${dmg} dano!`, '#0f0');
                anim('fig-b'); refreshBars();
                if(bt.bHP <= 0) win();
            }, 300);

            setTimeout(() => {
                img.classList.remove('animate-player-atk');
                if(bt.bHP > 0) setTimeout(bossTurn, 200);
                else btns.classList.remove('disabled-state');
            }, 700);
        }

        function bossTurn() {
            let dmg = 15; bt.pHP -= dmg;
            log(`Boss atacou: ${dmg} dano!`, 'red');
            anim('fig-p'); refreshBars();
            document.getElementById("battle-btns").classList.remove('disabled-state');
        }

        function updateUI() {
            document.getElementById("hub-name").textContent = p.name;
            document.getElementById("st-lv").textContent = p.lv;
            document.getElementById("st-hp").textContent = p.hpM;
            document.getElementById("st-str").textContent = p.str;
            document.getElementById("hub-coins").textContent = p.coins;
            localStorage.setItem("bps_v3_save", JSON.stringify(p));
        }

        function log(m, c) { const l = document.getElementById("battle-log"); l.innerHTML = `<div style="color:${c}">> ${m}</div>` + l.innerHTML; }
        function anim(id) { const e = document.getElementById(id); e.classList.add('animate-shake'); setTimeout(()=>e.classList.remove('animate-shake'),200); }
        function refreshBars() {
            document.getElementById("bt-hp-p").style.width = (bt.pHP/bt.pMaxHP*100)+"%";
            document.getElementById("bt-hp-b").style.width = (bt.bHP/bt.bMaxHP*100)+"%";
        }
        function win() { alert("BOSS DERROTADO!"); changeScreen('scr-hub'); }
        function resetGame() { localStorage.clear(); location.reload(); }
        function exportSave() { prompt("C√ìDIGO SAVE:", btoa(JSON.stringify(p))); }
    </script>
</body>
            </html>
